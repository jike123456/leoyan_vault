# 4.7 [I2C]封装常用功能

## 主要内容
封装 I2C 读写寄存器的通用函数。
## 1.I2C的初始化
```c
void My_I2C1_Init(void);// 声明初始化函数

int main(void)
{	
	My_I2C1_Init();//进行调用
	while(1)
	{		
	}
}

void My_I2C1_Init(void)//初始化函数的函数体
{
	//# 1.对PB6与PB7进行初始化
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOB, ENABLE);//使用引脚的时钟
	
	GPIO_InitTypeDef GPIO_InitStruct;
	GPIO_InitStruct.GPIO_Pin = GPIO_Pin_6 | GPIO_Pin_7;
	GPIO_InitStruct.GPIO_Mode = GPIO_Mode_AF_OD;
	GPIO_InitStruct.GPIO_Speed = GPIO_Speed_2MHz;
	GPIO_Init(GPIOB, &GPIO_InitStruc);
	
	//#2. 对I2C1进行初始化
	RCC_APB1PeriphClockCmd(RCC_APB1Periph_I2C1, ENABLE);//使能I2C的时钟
	RCC_APB1PeriphResetCmd(RCC_APB1Periph_I2C1, ENABLE);//复位
	RCC_APB1PeriphResetCmd(RCC_APB1Periph_I2C1, DISABLE);//释放
	
	I2C_InitTypeDef I2C_InitStruct;
	I2C_InitStruct.I2C_ClockSpeed = 400000;
	I2C_InitStruct.I2C_Mode = I2C_Mode_I2C;
	I2C_InitStruct.I2C_DutyCycle = I2C_DutyCycle_2;
	I2C_Init(I2C1, &I2C_InitStruct);
	
	I2C_Cmd(I2C1, ENABLE);
}
```
默认时钟都是关闭的，==省电==，需要进行使能

进行出厂设置：复位，释放：==清除数据==

外设需要进行`_cmd` 打开外设；

结构体初始化类似。

![500](assets/P23_4.7_封装常用功能/file-20260108210643735.png)
为什么是uint8、16，是怎么界定的

![500](assets/P23_4.7_封装常用功能/file-20260108210833448.png)
