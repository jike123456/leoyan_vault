# 5.1 [SPI]电路结构和通信协议

## 主要内容
SPI (Serial Peripheral Interface) 的基本概念。

### SPI 简介
*   四线式串行总线：**SCK (时钟)**, **MOSI (主机输出从机输入)**, **MISO (主机输入从机输出)**, **SS (片选)**。
*   全双工，同步通信。
*   速度远快于 I2C (可达 M/bps 级别)。

### 硬件电路
*   **SS (Slave Select)**：每个从机一根线。主机拉低某根 SS 线，选中对应从机。
*   **推挽输出**：SCK, MOSI, SS 都是推挽输出，驱动能力强。MISO 也是推挽 (从机控制)。

### SPI 时序 (4种模式)
由 **CPOL (时钟极性)** 和 **CPHA (时钟相位)** 决定。
1.  **Mode 0** (CPOL=0, CPHA=0)：SCK 空闲低电平，**第 1 个边沿** (上升沿) 采样数据。*(最常用)*
2.  **Mode 1** (CPOL=0, CPHA=1)：SCK 空闲低电平，**第 2 个边沿** (下降沿) 采样数据。
3.  **Mode 2** (CPOL=1, CPHA=0)：SCK 空闲高电平，**第 1 个边沿** (下降沿) 采样数据。
4.  **Mode 3** (CPOL=1, CPHA=1)：SCK 空闲高电平，**第 2 个边沿** (上升沿) 采样数据。

### 交换字节
SPI 通信本质是**交换**。主机发送一个 bit 的同时，接收一个 bit。
`Byte_Rx = SPI_SwapByte(Byte_Tx)`
