# 2.2 [GPIO]IO的最大输出速度

## 主要内容
介绍 GPIO 配置中的“输出速度”选项的含义和选择策略。

### 输出速度等级
在配置 GPIO 时，通常有三种速度可选：
1.  **Low Speed (2MHz)**
2.  **Medium Speed (10MHz)**
3.  **High Speed (50MHz)**

### 含义
*   这里的速度指的是 I/O 口驱动电路的**响应速度** (即信号上升沿和下降沿的陡峭程度)，而不是输出信号的频率。
*   速度越高，驱动电路的开关切换越快，信号边沿越陡峭。

### 深入理解 IO 的最大输出速度

#### 1. 什么是 IO 的==最大输出速度？==
IO 的最大输出速度本质上是 **I/O 驱动电路的响应速度**，在物理上表现为电压转换的速率（Slew Rate，摆率）。
*   STM32 内部有多个不同驱动能力的电路供用户选择。
*   **速度等级越高** = **驱动电流越大** = **对负载电容充放电越快** = **信号上升/下降越快**。
*   如果信号频率超过了当前速度等级的响应能力，输出波形就会==失真==（例如：==方波变梯形波，甚至变成正弦波或三角波==），因为电压还没来得及升到高电平，就开始下降了。

#### 2. 上升时间、下降时间和保持时间
描述数字信号波形质量的三个关键参数：
*   **上升时间 ($T_{rise}$)**：信号从低电平（通常是 10% VDD）上升到高电平（90% VDD）所需要的时间。
*   **下降时间 ($T_{fall}$)**：信号从高电平（90% VDD）下降到低电平（10% VDD）所需要的时间。
*   **保持时间 ($T_{hold}$)**：信号在逻辑电平上保持稳定的时间。
    *   速度等级设置主要影响 **上升时间** 和 **下降时间**。
    *   设置的速度越高，MOS 管导通电阻越小，电流越大，$T_{rise}$ 和 $T_{fall}$ 越短，波形越陡峭。

#### 3. 什么限制了 IO 的最大输出速度？
主要受 **负载电容 ($C_L$)** 和 **PCB 走线阻抗** 的限制。
*   **充放电原理**：引脚输出高电平是对负载电容充电，输出低电平是对负载电容放电。
*   **限制因素**：
    *   **负载电容越大**，电平变化越慢（$RC$ 时间常数变大）。
    *   如果要驱动长导线或大电容负载，必须选择更高的速度等级（更强的驱动能力）才能保证波形不失真。

#### 4. 最大输出速度应该如何选择？
选择原则：**够用即可，能低不高**。

*   **为什么不一直用最高速度 (50MHz)？**
    *   **功耗**：速度越高，内部驱动电路开关损耗越大，功耗越高。
    *   **噪声 (EMI)**：极快的上升/下降沿包含丰富的高频谐波分量，会产生严重的电磁干扰 (EMI)，并可能导致信号在线路上产生 **振铃 (Ringing)** 和 **过冲 (Overshoot)**。

*   **推荐配置**：
    *   **2MHz (Low Speed)**：LED 控制、继电器、蜂鸣器、普通按键扫描、低速 UART (如 9600)。
    *   **10MHz (Medium Speed)**：I2C (400k)、低速 SPI、普通 PWM。
    *   **50MHz (High Speed)**：高速 SPI (如 18M)、高速 USART (如 4.5M)、MCO 时钟输出、高频 PWM。

