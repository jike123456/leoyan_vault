# 第四章-11-主机状态监控

对Linux主机的状态进行监控是系统管理中至关重要的一环，它能帮助我们及时发现系统瓶颈、预测潜在问题并进行性能优化。本章将介绍一些常用的命令行工具，用于监控CPU、内存、磁盘I/O和网络使用情况。

## 1. `uptime` 命令：查看系统运行时间与负载

`uptime` 命令用于显示系统已经运行了多长时间、当前有多少登录用户以及系统的平均负载。

**基本用法：**
```bash
uptime
```

**输出示例：**
```
 10:30:00 up 1 day, 2:30,  2 users,  load average: 0.05, 0.10, 0.15
```

**字段解释：**
*   `10:30:00`: 当前时间。
*   `up 1 day, 2:30`: 系统已运行时间（1天2小时30分钟）。
*   `2 users`: 当前登录用户数。
*   `load average: 0.05, 0.10, 0.15`: 系统平均负载，分别表示过去1分钟、5分钟和15分钟的平均负载。平均负载是指在特定时间间隔内，系统中处于可运行状态和不可中断睡眠状态的进程的平均数量。理想情况下，对于单核CPU，负载值应小于1。

## 2. `free` 命令：查看内存使用情况

`free` 命令用于显示系统内存的使用情况，包括物理内存和交换空间。

**基本用法：**
```bash
free -h
```

**常用选项：**
*   `-h`: 以人类可读的格式（如G、M）显示。
*   `-b`, `-k`, `-m`, `-g`: 分别以字节、KB、MB、GB为单位显示。
*   `-w`: 显示有关内存和交换的详细信息，包括可用内存量。

**输出示例：**
```
              total        used        free      shared  buff/cache   available
Mem:           7.7G        1.2G        5.0G        200M        1.5G        6.0G
Swap:          2.0G          0B        2.0G
```

**字段解释：**
*   `total`: 总物理内存/交换空间。
*   `used`: 已使用的内存/交换空间。
*   `free`: 完全空闲的内存/交换空间。
*   `shared`: 被多个进程共享的内存。
*   `buff/cache`: 被内核用作缓冲区和缓存的内存。
*   `available`: 应用程序可用内存（预估值）。

## 3. `df` 命令：查看磁盘空间使用情况

`df` 命令（disk free）用于显示文件系统的磁盘空间使用情况。

**基本用法：**
```bash
df -h
```

**常用选项：**
*   `-h`: 以人类可读的格式显示。
*   `-T`: 显示文件系统类型。
*   `-i`: 显示inodes使用情况。

**输出示例：**
```
Filesystem      Size  Used Avail Use% Mounted on
/dev/sda1        50G  8.0G   39G  18% /
tmpfs           3.9G     0  3.9G   0% /dev/shm
/dev/sdb1       100G   10G   85G  11% /data
```

## 4. `du` 命令：查看文件或目录占用空间

`du` 命令（disk usage）用于估算文件或目录的磁盘空间使用量。

**基本用法：**
```bash
du -sh /path/to/directory
```

**常用选项：**
*   `-h`: 以人类可读的格式显示。
*   `-s`: 只显示总计。
*   `-c`: 显示所有参数的总和。

**示例：**
*   查看当前目录的总大小：
    ```bash
    du -sh .
    ```
*   查看 `/var/log` 目录下所有子目录的大小：
    ```bash
    du -h /var/log
    ```

## 5. `iostat` 命令：监控磁盘I/O

`iostat` 命令用于报告中央处理器（CPU）统计信息和设备/分区I/O统计信息。它通常需要安装 `sysstat` 包。

**安装 (以Ubuntu为例)：**
```bash
sudo apt update
sudo apt install sysstat
```

**基本用法：**
```bash
iostat -xdc 1 5
```
（每秒刷新一次，共刷新5次，显示扩展的设备I/O统计、CPU统计）

**输出示例（部分）：**
```
avg-cpu:  %user   %nice %system %iowait  %steal   %idle
           0.00    0.00    0.00    0.00    0.00  100.00

Device            r/s     w/s     rkB/s     wkB/s   rrqm/s   wrqm/s  %rrqm  %wrqm  a_wait  svctm  %util
sda              0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00    0.00   0.00   0.00
```

**常用选项：**
*   `-x`: 显示扩展统计信息。
*   `-d`: 仅显示磁盘使用情况。
*   `-c`: 仅显示CPU使用情况。
*   `interval count`: 间隔时间和刷新次数。

## 6. `sar` 命令：收集、报告和保存系统活动信息

`sar` 命令（System Activity Reporter）是 `sysstat` 工具包中的另一个强大工具，用于收集、报告和保存系统活动信息。它能提供历史数据，非常适合长期性能分析。

**示例：**
*   查看CPU使用情况：
    ```bash
    sar -u 1 5
    ```
    （每秒采样一次CPU数据，共采样5次）
*   查看内存使用情况：
    ```bash
    sar -r 1 5
    ```
*   查看磁盘I/O：
    ```bash
    sar -b 1 5
    ```
*   查看网络I/O：
    ```bash
    sar -n DEV 1 5
    ```

## 7. `ifstat` 命令：查看网络接口流量

`ifstat` 命令用于实时监控网络接口的流量。它通常需要安装 `ifstat` 包。

**安装 (以Ubuntu为例)：**
```bash
sudo apt update
sudo apt install ifstat
```

**基本用法：**
```bash
ifstat
```

## 8. `nmon` 命令：一体化系统性能监控

`nmon` (Nigel's Monitor) 是一个功能强大的一体化性能监控工具，可以实时显示CPU、内存、磁盘、网络、进程等多种系统资源的使用情况，并可将数据记录到文件中进行分析。

**安装 (以Ubuntu为例)：**
```bash
sudo apt update
sudo apt install nmon
```

**基本用法：**
```bash
nmon
```
进入 `nmon` 界面后，可以按不同的键来切换显示不同的信息，例如：
*   `c`: CPU
*   `m`: 内存
*   `d`: 磁盘
*   `n`: 网络
*   `t`: 进程列表

## 总结

掌握上述主机状态监控工具，能够帮助系统管理员和开发人员全面了解Linux系统的运行状况，及时发现和解决性能问题，确保服务的稳定性和高可用性。在实际工作中，可以根据具体需求选择合适的工具进行监控。
