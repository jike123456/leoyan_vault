# Linux 日期与时区管理

在Linux系统中，正确的时间和时区配置对于日志记录、任务调度（cron）、网络通信和程序运行都至关重要。本笔记将介绍两个核心工具：用于显示和格式化时间的 `date` 命令，以及用于管理系统时区和时间的 `timedatectl` 命令。

---

## 一、`date` 命令：显示与格式化时间

`date` 命令主要用于查看和格式化系统当前的日期和时间，它在脚本编程中尤其有用。

### 1. 理论
`date` 命令可以读取系统时钟，并按照用户的要求将其格式化成各种字符串形式。它也可以（需要管理员权限）用来设置系统时间。

### 2. 常用操作

#### (1) 直接显示当前时间
不加任何参数，直接显示当前日期、时间和时区。
```bash
date
# > Sat Dec 13 16:30:15 CST 2025
```

#### (2) 自定义格式化输出
这是 `date` 最强大的功能，使用 `+` 加上格式化字符来定义输出。

**语法**：`date +"<格式化字符串>"`

**常用格式化字符**：

| 字符   | 含义                                      | 示例           |
| :--- | :-------------------------------------- | :----------- |
| `%Y` | 四位年份                                    | `2025`       |
| `%m` | 两位月份 (01-12)                            | `12`         |
| `%d` | 两位日期 (01-31)                            | `13`         |
| `%H` | 24小时制 (00-23)                           | `16`         |
| `%M` | 分钟 (00-59)                              | `30`         |
| `%S` | 秒 (00-59)                               | `15`         |
| `%F` | 完整日期，相当于 `%Y-%m-%d`                     | `2025-12-13` |
| `%T` | 完整时间，相当于 `%H:%M:%S`                     | `16:30:15`   |
| `%s` | Unix时间戳 (自1970-01-01 00:00:00 UTC以来的秒数) | `1765595415` |
| `%Z` | 时区简称                                    | `CST`        |

**示例**：
```bash
# 生成一个适合文件名的日期字符串
date +"%Y%m%d_%H%M%S"
# > 20251213_163015

# 生成一个标准的日志时间格式
date +"%Y-%m-%d %T"
# > 2025-12-13 16:30:15
```
![500](assets/第四章-05-日期和时区/file-20251215135344313.png) ==+要到双引号的里面==
#### (3) 查看过去或未来的时间
使用 `-d` 或 `--date` 参数可以进行日期计算。
```bash
# 查看明天的日期
date -d "tomorrow"

# 查看10天前的日期
date -d "10 days ago"
date -d "+1 day"

# 将一个时间戳转换为可读日期
date -d @1765595415
# > Sat Dec 13 16:30:15 CST 2025
```

---

## 二、`timedatectl` 命令：配置系统时间和时区

`timedatectl` 是在现代 `systemd` 系统上管理时间和日期的首选工具，它提供了更全面、更简单的配置方式。

### 1. 理论
`timedatectl` 可以同时管理“本地时间”（Local time，你电脑上显示的时间）、“世界协调时间”（Universal time, UTC）和“实时时钟”（RTC, 硬件时钟），并能方便地配置时区和网络时间同步（NTP）。

### 2. 常用操作

#### (1) 查看当前时间状态
不加任何参数，显示所有时间相关信息。
```bash
timedatectl
# 或 timedatectl status
```
**输出示例**：
```
               Local time: Sat 2025-12-13 16:30:15 CST
           Universal time: Sat 2025-12-13 08:30:15 UTC
                 RTC time: Sat 2025-12-13 08:30:15
                Time zone: Asia/Shanghai (CST, +0800)
System clock synchronized: yes
              NTP service: active
          RTC in local TZ: no
```
这个输出告诉我们：本地时间是上海时间（CST, 东八区），系统时钟已通过NTP服务激活并同步。

#### (2) 列出并设置时区
修改时区是 `timedatectl` 的核心功能之一。

**步骤**：

1.  **列出所有可用时区**：
    ```bash
    timedatectl list-timezones
    ```
2.  **使用 `grep` 筛选你需要的时区**：
    ```bash
    timedatectl list-timezones | grep "Asia/Shanghai"
    # > Asia/Shanghai
    ```
3.  **设置时区** ==(需要 `sudo` 权限)：==
    ```bash
    sudo timedatectl set-timezone "Asia/Shanghai"
    ```
    设置完成后，`/etc/localtime` 文件会被自动更新为一个指向正确时区文件的符号链接。
#### (3) 配置网络时间同步 (NTP)
NTP服务可以使你的系统时钟自动与互联网上的时间服务器保持同步，强烈建议开启。

```bash
# 开启NTP同步 (推荐)
sudo timedatectl set-ntp true

# 关闭NTP同步
sudo timedatectl set-ntp false
```
**注意**：如果你想手动设置时间（不推荐），必须先关闭NTP。

## 三、总结与最佳实践

- **配置用 `timedatectl`**：当你需要**修改**系统时区、开启/关闭NTP同步时，请使用 `timedatectl`。这是现代、安全且标准化的做法。
- **显示和脚本用 `date`**：当你需要在脚本中获取、计算或格式化日期时间字符串时，`date` 命令是无与伦d比的灵活工具。
- **保持NTP开启**：对于服务器和桌面系统，始终开启NTP同步是保证时间准确的最佳实践。
