# 第10章：结构体 (Struct) —— 嵌入式硬件映射的基础

## 1. 为什么需要结构体？

结构体可以将不同类型的数据组合成一个整体。比如描述一个学生，或者描述一个传感器的数据包。

```c
struct SensorData {
    uint8_t id;
    float temperature;
    float humidity;
};

struct SensorData sensor1;
sensor1.id = 1;
sensor1.temperature = 25.5;
```

## 2. 结构体指针与 `->`

当我们将结构体传递给函数时，通常传指针（避免拷贝整个结构体，节省栈空间）。

```c
void print_sensor(struct SensorData *p) {
    // 方式1：解引用后访问 (繁琐)
    // printf("%d", (*p).id);
    
    // 方式2：箭头运算符 (推荐)
    printf("ID: %d, Temp: %.2f\n", p->id, p->temperature);
}
```

## 3. 内存对齐 (Struct Padding) —— 嵌入式大坑

编译器为了提高 CPU 访问速度，会自动给结构体成员之间填充字节（Padding），使得成员地址对齐。

```c
struct Test {
    char a; // 1 byte
    // --- 这里会自动填充 3 byte (Padding) ---
    int b;  // 4 bytes
};
// sizeof(struct Test) 往往是 8，而不是 5！
```

**影响**：
当你通过串口或网络直接发送结构体数据时，接收方如果是不同的架构（或者未对其），可能会解析错误。
**解决**：使用 `#pragma pack(1)` 告诉编译器取消对齐（紧凑排列），虽然访问速度变慢，但数据布局可控。

## 4. 结构体位域 (Bit Fields)

嵌入式特有技巧，用于节省空间或映射寄存器位。
```c
struct Flags {
    uint8_t is_running : 1; // 占用 1 bit
    uint8_t has_error  : 1; // 占用 1 bit
    uint8_t reserved   : 6; // 占用 6 bits
};
```

