# 第11章：全局变量与宏 (Macro)

## 1. 全局变量 (Global Variable)

定义在所有函数之外的变量。
- **优点**：所有函数都能访问，方便共享数据。
- **缺点**：任何函数都能修改它，容易导致不可复现的 Bug；长期占用内存。

**多文件共享**：
- `main.c`: `int g_count = 0;` (定义)
- `other.c`: `extern int g_count;` (声明，告诉编译器这个变量在别处)

## 2. static 关键字 (模块化封装)

`static` 在 C 语言中有两个完全不同的用法：

1.  **修饰全局变量/函数**：限制作用域。
    - `static int g_private;`
    - 这个变量**只能在当前 .c 文件中访问**，其他文件看不见。这是 C 语言实现“私有成员”的方法，防止命名冲突。
    
2.  **修饰局部变量**：改变生存期。
    ```c
    void count_calls() {
        static int cnt = 0; // 只初始化一次
        cnt++;
        printf("Called %d times\n", cnt);
    }
    ```
    每次调用函数，`cnt` 都会保留上次的值，而不会重置。

## 3. volatile 关键字 (嵌入式面试必问)

告诉编译器：**这个变量可能会被意外修改（如硬件中断、寄存器），不要去优化它！**

```c
// 错误写法
int flag = 0;
while (flag == 0) {
    // 编译器可能觉得循环里没改 flag，直接优化成 while(true) 死循环
}

// 正确写法
volatile int flag = 0; 
// 编译器每次都会老老实实去内存里读取 flag 的最新值
```

## 4. 预处理指令与宏 (#define)

- **常量定义**：`#define PI 3.14159`
- **宏函数**：`#define MAX(a, b) ((a) > (b) ? (a) : (b))`
    - **注意括号**：宏只是简单的文本替换，不加括号容易算错优先级。

- **条件编译**：
```c
#ifdef DEBUG
    printf("Log output...\n");
#endif
```
这是控制代码版本（如调试版/发布版）的神器。
