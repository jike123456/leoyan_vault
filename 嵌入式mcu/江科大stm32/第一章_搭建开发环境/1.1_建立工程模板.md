# 1.1 建立工程模板

## 1. 核心概念理解

*   **启动过程**：
    *   STM32 上电复位后，首先执行启动文件（`startup_stm32f10x_md.s`）中的汇编代码。
    *   初始化堆栈指针 (SP)、程序计数器 (PC)，调用 `SystemInit` 函数初始化系统时钟（配置为 72MHz）。
    *   最后跳转到 C 语言的 `main` 函数。
*   **文件分类**：
    *   **Start**: 存放启动文件和内核接口文件（CMSIS标准）。
    *   **Library**: 存放 ST 官方提供的标准外设库驱动（src 和 inc）。
    *   **User**: 存放用户编写的代码（main.c, stm32f10x_it.c 等）。

## 2. 工程架构配置 (Standard Library)

在 Keil MDK 中建立工程时，建议按照以下物理文件夹和工程组（Group）进行管理：

| Group Name | 包含文件示例 | 说明 |
| :--- | :--- | :--- |
| **Start** | `startup_stm32f10x_md.s`<br>`core_cm3.c` / `.h`<br>`system_stm32f10x.c` / `.h` | 启动引导与内核配置 |
| **Library** | `stm32f10x_gpio.c`<br>`stm32f10x_rcc.c`<br>`misc.c` ... | 标准外设库源文件 |
| **User** | `main.c`<br>`stm32f10x_conf.h`<br>`stm32f10x_it.c` | 用户主逻辑与配置文件 |

*   **Include Paths (头文件路径)**：
    *   必须在 "C/C++" 选项卡的 Include Paths 中添加上述文件夹的路径，否则编译器找不到 `.h` 文件。

## 3. 预处理宏定义 (Define)

在 "Options for Target" -> "C/C++" -> "Define" 中必须填写：

`USE_STDPERIPH_DRIVER,STM32F10X_MD`

*   **`USE_STDPERIPH_DRIVER`**：告诉编译器我们使用了标准外设库，从而在 `stm32f10x.h` 中包含 `stm32f10x_conf.h`。
*   **`STM32F10X_MD`**：表示使用“中容量”产品（Medium Density）。
    *   江科大课程主要使用 **STM32F103C8T6**，它属于中容量设备（Flash 64KB/128KB）。
    *   如果是 ZET6/RCT6 等大容量，需改为 `STM32F10X_HD`。

## 4. 调试器设置

*   **Debug 选项卡**：选择 "ST-Link Debugger" 或 "CMSIS-DAP Debugger"。
*   **Settings**：
    *   勾选 "Reset and Run"（下载后自动复位运行，省去按复位键）。
    *   确保 "Flash Download" 中勾选了 "Program", "Verify", "Reset and Run"。