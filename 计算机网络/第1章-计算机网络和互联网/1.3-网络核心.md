# 1.3 网络核心 (The Network Core)

网络核心是由一系列相互连接的**路由器**组成的网状结构，其核心任务是在源和目的地之间移动数据。这是互联网的“骨干”和“中枢系统”。网络核心主要通过两种方式来交换数据：分组交换和电路交换。

---

### 1. 分组交换 (Packet Switching)

这是现代互联网使用的主导方式。它将长的报文（如一个图片、一封邮件）分割成一个个较小的数据块，称为**分组（Packet）**。

*   **存储转发 (Store-and-Forward)**
    *   **工作原理**: 路由器必须完整地接收整个分组，然后才能开始向下一个链路转发它。
    *   **类比**: 想象一个快递中转站。快递员不能在卡车还在卸货的时候，就把刚卸下来的一件货立刻扔到另一辆发货的车上。他必须等这辆卡车的所有货物都卸载完毕，检查了运单（即分组的头部信息），然后才能决定这些货物下一步该发往哪里。

*   **排队时延和丢包 (Queuing Delays and Packet Loss)**
    *   **排队**: 每个路由器都为它的每条输出链路维护一个**输出队列（Output Queue）**。如果多个分组同时到达，并且都需要从同一个链路转发出去，那么后到的分组就必须在队列中排队等待。
    *   **时延**: 排队等待的时间就是**排队时延**。如果网络流量很大，队列可能会变得很长，导致时延显著增加。
    *   **丢包 (Packet Loss)**: 队列的容量是有限的。如果分组到达时，队列已满，路由器就会**丢弃（Drop）**这个分组，这就造成了**丢包**。
    *   **类比**: 就像高速公路收费站，如果车流量太大，每个收费通道口都会排起长队（排队时延）。如果长队排满了整个收费站广场，后来的车就无法进入，只能掉头离开（丢包）。

---

### 2. 电路交换 (Circuit Switching)

这是一种传统的网络交换方式，在电话网络中仍在使用。

*   **工作原理**: 在数据传输开始之前，必须在发送方和接收方之间建立一条**专用的、端到端的电路**。这条电路在整个通信期间会被预留和独占，所有数据都沿着这条固定路径传输。
*   **资源预留**: 电路所占用的链路带宽、交换机处理能力等资源在通信期间是**被保证的**，不会被其他通信共享。
*   **多路复用 (Multiplexing)**: 为了让一条物理链路能承载多条电路，通常使用以下技术：
    *   **频分多路复用 (FDM)**: 将链路的频谱（频率范围）划分为多个小频段，每个电路分配一个频段。
    *   **时分多路复用 (TDM)**: 将时间划分为固定长度的帧，每个帧再划分为固定数量的时隙，每个电路分配一个时隙。
*   **与分组交换的对比**:
    *   **性能**: 电路交换能提供**有保证的**、恒定的性能（如固定速率），但当预留的电路空闲时，资源被浪费。分组交换的性能取决于网络负载，是“尽力而为”的服务，但**资源利用率更高**。
    *   **适用场景**: 电路交换适合需要稳定、持续数据传输的传统电话业务。分组交换更适合互联网中突发性强、对资源共享要求高的数据通信。

---

### 3. "网络的网络" - 互联网的结构

互联网并不是一个单一、统一的网络，而是由成千上万个独立管理、相互连接的网络组成的“网络的网络”。

*   **互联网服务提供商 (Internet Service Provider, ISP)**: 用户通过接入ISP来连接到互联网。ISP自身也形成了一个层次结构：
    *   **一级ISP (Tier-1 ISP)**: 规模巨大的全球性网络，如AT&T, NTT。它们之间通常免费互联。
    *   **区域性ISP 和 接入ISP**: 连接到一级ISP，并为最终用户提供服务。
*   **互联网交换点 (Internet Exchange Point, IXP)**: 这是一个物理基础设施，允许不同的ISP在这里直接互联，而无需通过第三方ISP转发流量，从而降低成本和时延。
*   **内容提供商网络 (Content Provider Networks)**: 像Google, Microsoft, Akamai这样的大公司会建立自己的全球性网络，以更好地控制其服务的交付，并减少向一级ISP支付的费用。

---

### 4. 性能指标：时延、丢包和吞吐量

*   **时延 (Delay)**: 一个分组从源到目的地经历的总时延由四部分组成：
    1.  **处理时延 (Processing Delay)**: 路由器检查分组首部、决定转发路径所需的时间。
    2.  **排队时延 (Queuing Delay)**: 分组在输出队列中等待传输的时间。这是唯一一个变化范围很大的时延。
    3.  **传输时延 (Transmission Delay)**: 将整个分组推向链路所需的时间。计算公式：`L/R` (L=分组长度，R=链路带宽)。
    4.  **传播时延 (Propagation Delay)**: 信号在物理介质中传播所需的时间。计算公式：`d/s` (d=物理距离，s=传播速度)。

*   **丢包 (Packet Loss)**: 当网络拥塞导致路由器队列溢出时发生。丢失的分组可能需要由上层协议（如TCP）进行重传。

*   **吞吐量 (Throughput)**: 在源和目的地之间，数据传输的实际速率。它受到网络中**瓶颈链路 (Bottleneck Link)** 的限制，即端到端路径上带宽最小的那一段链路。
