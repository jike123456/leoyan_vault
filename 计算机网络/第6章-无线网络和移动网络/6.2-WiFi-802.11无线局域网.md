# 6.2 WiFi: 802.11 无线局域网

IEEE 802.11标准，俗称WiFi，是当今使用最广泛的无线局域网技术。它定义了无线设备如何通过共享的空中媒介进行通信。

---

### 1. 802.11 体系结构

*   **基本服务集 (Basic Service Set, BSS)**: 这是WiFi网络的基本构建模块。它由一个或多个无线主机（也称为**站点，Station**）和一个可选的中心基站（**接入点，Access Point**）组成。
*   **接入点 (Access Point, AP)**:
    *   **角色**: AP扮演着一个“桥梁”的角色，负责连接无线局域网和有线的以太网。
    *   **功能**: 它为BSS中的所有无线站点协调通信，并将它们的数据转发到有线网络中。
    *   **类比**: AP就像是一个无线信号的“翻译官”和“交通指挥官”。
*   **基础设施模式 (Infrastructure Mode)**: 这是最常见的WiFi网络模式，其中所有通信都必须通过AP进行中转。即使两个在同一房间的设备相互通信，它们的数据帧也需要先发送给AP，再由AP转发给对方。

---

### 2. 802.11 MAC 协议: CSMA/CA

由于无线信道的复杂性（如隐藏终端问题），有线以太网的CSMA/CD（碰撞检测）协议不再适用。802.11采用了一种更谨慎的**带碰撞避免的CSMA (CSMA/CA - Collision Avoidance)** 协议。

*   **核心思想**: 尽量在碰撞发生**之前**就避免它。
*   **基本工作流程**:
    1.  **先听后说 (CSMA)**: 发送方在发送前，先侦听信道。如果信道忙，则等待。
    2.  **随机退避**: 如果信道空闲，发送方不会立即发送，而是会再等待一个很短的随机时间。这是为了防止多个同时侦听到信道空闲的节点同时开始发送。
    3.  **链路层确认 (ACK)**: 由于发送方无法检测到碰撞，因此802.11协议要求接收方在成功收到一个数据帧后，必须回复一个**ACK确认帧**。
    4.  **超时重传**: 如果发送方在规定时间内没有收到ACK，它就认为该数据帧丢失（可能因为碰撞或噪声），并会重传该帧。

*   **解决隐藏终端问题: RTS/CTS 握手 (可选)**
    *   **问题**: 即使有CSMA/CA，隐藏终端问题仍然可能导致碰撞。
    *   **解决方案**: 对于较大的数据帧，发送方可以先发送一个很短的**请求发送 (Request to Send, RTS)** 帧来“预约”信道。
        1.  AP收到RTS后，会广播一个**清除发送 (Clear to Send, CTS)** 帧。
        2.  这个CTS帧会被AP范围内的所有节点（包括那个对发送方来说是“隐藏”的终端）听到。
        3.  听到了CTS的节点，就知道即将有一次数据传输发生，于是在接下来的时间里会保持静默，从而避免了碰撞。
    *   **开销**: RTS/CTS握手虽然有效，但也带来了额外的延迟和开销，因此通常只对超过一定长度的数据帧使用。

---

### 3. 802.11 帧结构

802.11的帧结构比以太网帧更复杂，因为它需要处理无线环境的特殊性。其首部包含多个地址字段：

*   **地址1**: 接收该帧的无线站点的MAC地址。
*   **地址2**: 发送该帧的无线站点的MAC地址。
*   **地址3**: 通常是AP的MAC地址，用于与有线网络进行交互。
*   **地址4**: 在某些高级模式下使用。

这种多地址结构使得帧能够在不同的BSS之间正确路由。

---

### 4. 与AP的关联

一个无线设备要加入一个WiFi网络，需要经过以下步骤：

1.  **扫描 (Scanning)**: 设备会扫描所有WiFi信道，以发现附近有哪些AP，并监听它们广播的**信标帧 (Beacon Frames)**。信标帧中包含了AP的网络名称（SSID）和安全设置等信息。
2.  **选择 (Choosing)**: 用户或设备根据信号强度、网络名称等信息，选择一个要连接的AP。
3.  **认证 (Authentication)**: 设备向AP表明身份（在WPA2/3等安全模式下，这是一个复杂的过程）。
4.  **关联 (Association)**: 设备向AP发送关联请求，AP同意后，设备就正式加入了该BSS。

---

### 5. 高级特性

*   **速率适应 (Rate Adaptation)**: 客户端和AP会根据当前的信噪比（SNR）等信道条件，动态地选择最合适的传输速率。信号好时用高速率，信号差时用低速率以保证可靠性。
*   **功率管理 (Power Management)**: 允许无线设备在没有数据收发时，通知AP它将进入“睡眠”状态。AP会为该设备缓存数据，直到它“醒来”并请求数据，这极大地延长了移动设备的电池寿命。
