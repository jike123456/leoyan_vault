# 6.4 移动管理 (Mobility Management)

移动性是无线网络最核心的特征之一。移动管理要解决的核心问题是：当一个设备（如手机、笔记本电脑）在网络中移动，从一个连接点切换到另一个连接点时，如何保证其网络通信不中断？

---

### 1. 基本原则与术语

*   **基本原则**:
    1.  **寻址与定位**: 无论移动设备跑到哪里，网络必须有办法能够**找到**它当前所在的位置。
    2.  **路由**: 将原本要发往该设备的数据，**转发**到它当前所在的新位置。

*   **关键术语**:
    *   **归属网络 (Home Network)**: 移动设备的“家”，它在这里拥有一个固定的、永久的IP地址。
    *   **永久地址 (Permanent Address)**: 移动设备在归属网络中的固定IP地址。无论设备去哪里，这个地址都不会改变。
    *   **归属代理 (Home Agent)**: 位于归属网络中的一台路由器，它负责跟踪移动设备的当前位置，并代为接收和转发发往该设备永久地址的数据。**类比：你家的“管家”**，他知道你出差到哪里了，并能把寄到家里的信转发给你。
    *   **外部网络 (Foreign Network)**: 移动设备当前漫游到的网络。
    *   **外部代理 (Foreign Agent)**: 位于外部网络中的一台路由器，它为漫游到此的移动设备提供服务。
    *   **转交地址 (Care-of Address, COA)**: 移动设备在外部网络中获得的临时IP地址。**类比：你出差时住的酒店地址**。

---

### 2. 移动IP (Mobile IP)

移动IP是IETF设计的、在网络层实现移动管理的标准协议。它使得移动设备在不同网络间切换时，能够保持其上层TCP连接不中断。

*   **工作流程**:
    1.  **代理发现**: 移动设备通过与外部代理交换报文，发现自己已进入一个外部网络。
    2.  **注册**: 移动设备通过外部代理，向其归属代理进行**注册**，告知其当前的转交地址（COA）。
    3.  **数据传输**: 归属代理截获所有发往该移动设备永久地址的数据报，并通过一个**隧道（Tunnel）**将这些数据报封装后，转发到其转交地址。

*   **数据路由方式**:

    *   **间接路由 (Indirect Routing)**
        *   **工作方式**:
            1.  **通信方 (Correspondent)** 像往常一样，将数据报发送到移动节点的**永久地址**。
            2.  数据报被路由到移动节点的**归属网络**，并被**归属代理**截获。
            3.  归属代理查询移动节点的当前位置（COA），将原始数据报**重新封装**在一个新的IP数据报中（即**隧道技术**），新的数据报的目的地址是COA。
            4.  封装后的数据报被路由到**外部网络**。
            5.  **外部代理**收到封装后的数据报，解封装，并将原始数据报交付给移动节点。
        *   **特点**: 对通信方完全透明，它根本不知道对方在漫游。但路径是低效的“三角路由”（通信方 -> 归属网络 -> 外部网络），增加了延迟。

    *   **直接路由 (Direct Routing)**
        *   **工作方式**: 为了克服三角路由的低效，通信方可以直接将数据发送到移动节点的COA。
            1.  通信方首先向归属代理查询移动节点的COA。
            2.  归属代理将COA回复给通信方。
            3.  通信方直接将数据报（目的地址为COA）发送到移动节点。
        *   **特点**: 路径更优，但增加了复杂性，需要通信方支持移动IP的扩展。

---

### 3. 蜂窝网络中的移动管理

蜂窝网络是移动管理最典型的应用场景。

*   **寻址**: 每个手机在开机时都会向网络注册，网络的核心数据库（如4G中的HSS）会记录该手机当前所在的基站位置。
*   **切换 (Handoff)**: 当你拿着手机从一个基站（如A）的覆盖范围移动到另一个基站（如B）的覆盖范围时：
    1.  手机和网络会监测到来自基站A的信号变弱，来自基站B的信号变强。
    2.  网络会决定执行切换。
    3.  核心网络（如MSC或MME）会协调基站A和基站B，建立一条通往基站B的新路径，并将手机的通信会话平滑地从旧路径切换到新路径上。
    4.  这个过程非常迅速，通常用户不会感觉到通话或数据传输的中断。
*   **路由**: 无论是打电话还是上网，所有发往你手机的数据，都会先被路由到核心网的**网关（Gateway）**，网关再根据HSS中记录的你的位置信息，将数据通过一系列内部路由器和基站，最终送到你的手机上。
