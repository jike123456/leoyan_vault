# 4.1 网络层概述

网络层在协议栈中处于核心位置，它提供的服务跨越了整个网络，而不仅仅是单一的链路。其最根本的任务是实现**主机到主机**的通信。

---

### 1. 核心功能：转发与路由

网络层的核心功能可以分解为两个既相关又不同的部分：转发和路由。

*   **转发 (Forwarding)**
    *   **定义**: 当一个数据分组到达路由器的一条输入链路时，路由器必须根据分组的目的地址，决定将其移动到哪一条输出链路。这是一个在**路由器内部**发生的、**局部的**、**毫秒级**的动作。
    *   **核心组件**: **转发表 (Forwarding Table)**。路由器通过查找此表来做出转发决定。
    *   **类比**: 你开车到了一个复杂的环岛或十字路口。你看着路牌（转发表），根据你的目的地（分组的目的地址），迅速决定从哪个出口驶出。这个“看路牌并打方向盘”的动作就是转发。

*   **路由 (Routing)**
    *   **定义**: 这是指网络层通过**路由算法**来计算并确定分组从发送方到接收方所要经过的路径（即一系列路由器的序列）的过程。这是一个在**整个网络范围**内发生的、**全局性的**、**时间尺度较长**的动作。
    *   **核心组件**: **路由算法 (Routing Algorithm)**。这些算法的计算结果被用来生成路由器的转发表。
    *   **类比**: 在你出发前，你使用手机地图（路由算法）规划出从家到公司的整条最佳行车路线，包括要经过哪些路口、在哪座桥转弯等。这个“规划路线”的过程就是路由。

**关系**: **路由**决定了路径，其结果填充了**转发表**；而**转发**则是在每个路由器上根据这个转发表来执行的实际动作。

---

### 2. 数据平面与控制平面 (Data Plane and Control Plane)

为了更好地理解网络层，我们可以将其功能划分为两个“平面”。

*   **数据平面 (Data Plane)**
    *   **功能**: 主要负责**转发**。它处理的是每个流经路由器的数据分组，包括从输入端口接收分组、在转发表中查找目的地址、将分组从交换结构送往输出端口等。
    *   **要求**: 速度极快，必须在纳秒或微秒级别完成，通常由硬件实现。

*   **控制平面 (Control Plane)**
    *   **功能**: 主要负责**路由**。它运行路由协议（如OSPF, BGP），与网络中其他路由器交换路由信息，最终计算并生成转发表。
    *   **要求**: 速度要求相对较低，可以在秒级或更长的时间尺度上完成，通常由软件实现（在路由器的CPU上运行）。

在传统路由器中，数据平面和控制平面是紧密耦合、共同实现在一台物理设备中的。而在现代的**软件定义网络 (Software-Defined Networking, SDN)** 架构中，控制平面被从路由器中分离出来，由一个远程的、集中的控制器来负责整个网络的路由计算，路由器只专注于执行数据平面的转发任务。

---

### 3. 网络服务模型 (Network Service Model)

网络层可以为从发送主机到接收主机传输的分组提供什么样的服务？

*   **因特网的服务模型**:
    *   **尽力而为服务 (Best-effort service)**: 这是IP协议提供的唯一服务模型。它对分组的传输**不做任何保证**。
        *   不保证分组一定能送达。
        *   不保证分组按序到达。
        *   不保证分组的延迟或抖动。
        *   不保证最小的带宽。
    *   **类比**: 普通平信邮政服务。

*   **其他可能的服务模型 (ATM网络等)**:
    *   **恒定比特率 (Constant Bit Rate, CBR)**: 保证分组以恒定的速率传输，提供严格的时延和抖动保证。适用于高质量的实时音视频。
    *   **可用比特率 (Available Bit Rate, ABR)**: 保证一个最低的比特率，但当网络资源可用时，可以使用更多的带宽。

尽管IP协议只提供“尽力而为”的服务，但这并不意味着互联网不能支持需要高质量服务的应用。实际上，互联网通过在**端系统**（运输层和应用层）增加复杂性（如TCP的可靠传输和拥塞控制），以及在网络边缘和核心增加一些QoS机制，来弥补网络层服务的不足。
