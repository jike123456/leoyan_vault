# 4.4 路由算法

路由算法是网络层控制平面的核心，其目标是为数据分组在网络中确定一条从源到目的地的“好”路径。这里的“好”通常指成本最低，成本可以是跳数、延迟、带宽等。我们将路由算法主要分为两大类：链路状态（LS）算法和距离向量（DV）算法。

---

### 1. 路由算法分类

*   **集中式 vs 分布式**:
    *   **集中式**: 由一个中心节点（如SDN控制器）收集整个网络的拓扑和链路信息，计算出所有路由，然后下发给各个路由器。
    *   **分布式**: 每个路由器只与它的邻居交换信息，通过迭代计算，最终共同确定路由。这是传统网络采用的方式。
*   **静态 vs 动态**:
    *   **静态**: 路由由网络管理员手动配置，不会自动适应网络变化。
    *   **动态**: 路由器能够响应网络拓扑或链路成本的变化，自动地重新计算并更新路由。
*   **负载敏感 vs 负载迟钝**:
    *   **负载敏感**: 链路成本会根据其当前的拥塞程度动态变化。
    *   **负载迟钝**: 链路成本是固定的，不随负载变化。当今的路由协议（如OSPF, BGP）通常是负载迟钝的。

---

### 2. 链路状态 (Link-State, LS) 路由算法

*   **核心思想**: 每个路由器都构建一幅完整的网络“地图”，然后在这张地图上独立地计算出从自己出发到所有其他节点的最短路径。
*   **类比**: 就像你出发前，拿到了一张包含了所有城市和道路信息的完整交通地图。你可以用这张地图规划出从你所在的城市到任何其他城市的最佳路线。
*   **工作过程**:
    1.  **发现邻居**: 路由器启动时，首先了解它的直接邻居和到邻居的链路成本。
    2.  **广播链路状态**: 每个路由器将自己所知道的链路状态信息（即“我是谁，我的邻居是谁，到邻居的成本是多少”）广播给网络中的**所有**其他路由器。
    3.  **构建拓扑图**: 每个路由器收集来自所有其他路由器的链路状态信息，从而在本地构建出一张完整的、一模一样的网络拓扑图。
    4.  **计算最短路径**: 每个路由器以自己为根节点，运行一个最短路径算法（如**Dijkstra算法**），计算出到所有其他节点的最短路径。
    5.  **生成转发表**: 根据计算出的最短路径，生成自己的转发表。
*   **代表协议**: **OSPF (Open Shortest Path First)**。
*   **特点**:
    *   **优点**: 每个路由器都掌握全局信息，不易产生路由环路；收敛速度相对较快。
    *   **缺点**: 广播链路状态会产生较大的网络开销；扩展性不如DV算法。

---

### 3. 距离向量 (Distance-Vector, DV) 路由算法

*   **核心思想**: 每个路由器都不知道网络的全貌，它只关心“我的邻居告诉我，从它那里到某个目的地有多远”。它是一种“听邻居的话”的分布式、迭代算法。
*   **类比**: 就像问路。你想去火车站，但你不知道怎么走。于是你问你的邻居A和B。
    *   A告诉你：“从我家到火车站，最近的路是10分钟。” 你知道你家到A家需要5分钟，所以你推断出经过A到火车站需要 `5 + 10 = 15` 分钟。
    *   B告诉你：“从我家到火车站，最近的路是8分钟。” 你知道你家到B家需要2分钟，所以你推断出经过B到火车站需要 `2 + 8 = 10` 分钟。
    *   比较之后，你决定去火车站的最佳下一跳是B。你会把这个信息记录下来，并告诉你的其他邻居：“从我家到火车站最近要10分钟”。
*   **工作过程**:
    1.  每个路由器维护一个**距离向量**，其中包含从它自己到网络中所有其他节点的距离（成本）估计。
    2.  路由器周期性地将其自身的距离向量发送给它的所有**邻居**。
    3.  当一个路由器收到来自邻居的距离向量时，它会使用**Bellman-Ford方程**来更新自己的距离向量。
    4.  这个过程不断迭代，直到没有更新发生，此时算法收敛。
*   **代表协议**: **RIP (Routing Information Protocol)**。
*   **问题**: **无穷计数问题 (Count-to-Infinity Problem)**。当网络中出现链路故障时，DV算法可能会因为“好消息传得快，坏消息传得慢”而导致路由环路和缓慢的收敛。可以通过“毒性逆转”（Poisoned Reverse）等技术来缓解此问题。

---

### 4. 层次路由 (Hierarchical Routing)

当网络规模变得极其巨大时（如整个互联网），任何单一的路由算法都无法胜任，因为：
1.  **规模**: 存储和广播所有节点的路由信息会产生巨大的开销。
2.  **管理自治性**: 每个组织（如公司、大学、ISP）都希望自主地管理和控制自己的内部网络，而不受外界干预。

因此，互联网采用了**层次路由**，将全球网络划分为数万个相互连接的**自治系统 (Autonomous Systems, AS)**。
*   **AS内部路由**: 在一个AS内部，由该AS的管理员选择一种**内部网关协议 (IGP)**，如OSPF或RIP。
*   **AS之间路由**: 在不同AS之间，则使用一种**外部网关协议 (EGP)**，即**BGP (Border Gateway Protocol)**。

这种分层结构极大地简化了路由问题，并保证了各个网络的管理自治权。
