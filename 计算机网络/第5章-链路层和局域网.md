# 第5章 链路层和局域网 (The Link Layer and LANs)

链路层位于网络层和物理层之间，其核心任务是负责将网络层的数据报（Datagram）在**相邻的两个节点**（如主机到路由器，或路由器到路由器）之间的一段**物理链路**上传输。我们将封装了网络层数据报的链路层分组称为**帧（Frame）**。

**类比**: 如果网络层负责规划从北京到上海的整条货运路线，那么链路层就负责其中**某一段**具体的运输，比如从北京的某个仓库开车到下一个高速路口。

## 核心内容

### 1. 链路层服务
链路层为网络层提供了一系列服务，以确保数据在单段链路上有效传输。
*   **成帧 (Framing)**: 将网络层的数据报封装成帧，加上链路层的头部和尾部信息。
*   **链路接入 (Link Access)**: 如果多个节点共享同一段链路（如WiFi），需要一个**媒体访问控制（MAC）协议**来协调谁可以使用链路，避免冲突。
*   **可靠交付 (Reliable Delivery)**: 在容易出错的链路上（如无线链路），链路层可以通过确认和重传机制提供可靠的交付服务。
*   **差错检测和纠正 (Error Detection and Correction)**: 检测或纠正在信号传输中可能发生的比特差错。

### 2. 差错检测和纠正技术
由于物理信号在传输中可能被噪声干扰，导致比特翻转（0变1或1变0），因此需要差错控制机制。
*   **奇偶校验 (Parity Checks)**: 最简单的方法，通过添加一个奇偶校验位，可以检测出奇数个比特的错误。
*   **校验和 (Checksumming)**: 在运输层和网络层也使用，通过对数据求和来检测错误。
*   **循环冗余检测 (Cyclic Redundancy Check, CRC)**: 一种更强大、检错能力更强的技术，广泛应用于以太网、WiFi等现代链路层协议中。

### 3. 多路访问链路和协议
当多个节点共享一个广播信道时（所有节点都能接收到其他节点发送的信号），就需要协议来协调它们的传输。
*   **信道划分协议**: 像切蛋糕一样，将信道资源预先划分好。
    *   **TDM (时分)**, **FDM (频分)**: 分别在时间和频率上划分资源。
*   **随机接入协议**: 节点独立地决定何时发送，但有处理冲突的机制。
    *   **CSMA/CD (载波侦听多路访问/碰撞检测)**:
        1.  **先听后说**: 发送前先侦听信道是否空闲。
        2.  **边说边听**: 发送数据的同时，继续侦听信道。如果检测到有其他人也在说（碰撞），则立即停止发送。
        3.  **碰撞后随机等待**: 发生碰撞后，等待一个随机的时间再尝试发送。这是**以太网（有线局域网）**的核心协议。
    *   **CSMA/CA (载波侦听多路访问/碰撞避免)**: 主要用于**无线网络（WiFi）**，因为无线环境中检测碰撞很困难，所以它更侧重于“避免”碰撞。

### 4. 交换局域网 (Switched LANs)
现代局域网（LAN）的核心是链路层交换机。
*   **链路层地址 (MAC地址)**: 每个网络接口都有一个全球唯一的、固化在硬件中的48位MAC地址。这是链路层用于标识节点的地址。
*   **ARP (地址解析协议)**: 这是IP地址和MAC地址之间的“翻译官”。当一台主机想给另一台在同一个子网内的主机发送数据报时，它知道对方的IP地址，但不知道其MAC地址。ARP协议就是用来通过广播查询“这个IP地址是谁？请告诉我你的MAC地址”的。
*   **以太网 (Ethernet)**: 当今最主流的局域网技术，它定义了帧的格式和CSMA/CD协议。
*   **链路层交换机 (Switches)**:
    *   **核心功能**: 接收以太网帧，并根据帧中的**目的MAC地址**，将其**精确地**转发到对应的输出端口。
    *   **自学习**: 交换机通过观察流经它的帧的**源MAC地址**，自动学习到哪个MAC地址的主机连接在哪个端口上，并建立一个**交换机表**。
    *   **优点**:
        1.  **消除碰撞**: 每个端口都是一个独立的碰撞域，不同端口之间的通信不会相互干扰。
        *   **异质链路**: 可以连接不同速率的以太网。
*   **虚拟局域网 (VLANs)**: 允许网络管理员在单个物理交换机上创建多个虚拟的广播域，从而提高网络的安全性、隔离流量并简化管理。

本章内容连接了网络软件（协议）和硬件（物理媒体），解释了数据如何在最基础的物理链路上进行可靠、高效的传输，是构建整个网络通信大厦的地基。
