# 3.1 运输层服务介绍

运输层位于应用层和网络层之间，是协议栈中至关重要的一环。它为运行在不同主机上的**应用程序进程**之间提供**逻辑通信（Logical Communication）**的能力。

---

### 1. 运输层和网络层的关系

要理解运输层的作用，最好的方式是将其与网络层进行对比。

*   **网络层 (Network Layer)**:
    *   **服务对象**: 主机 (Host)。
    *   **功能**: 提供**主机之间**的逻辑通信。它负责将数据包从一台主机发送到另一台主机，但不关心数据包最终由哪一个应用程序接收。
    *   **类比**: 邮政系统。它只负责将信件从**一栋大楼（源主机）**投递到**另一栋大楼（目的主机）**。至于信件具体是送给这栋楼里的张三还是李四，邮政系统并不关心。

*   **运输层 (Transport Layer)**:
    *   **服务对象**: 进程 (Process)。
    *   **功能**: 在网络层服务的基础上，为**进程之间**提供逻辑通信。它确保从一个应用程序进程发出的报文，能够准确无误地到达另一个应用程序进程。
    *   **类比**: 大楼里的**收发室**。当邮政系统把一大堆信件送到大楼后，收发室会根据信封上的具体收件人姓名或部门（相当于**端口号**），将每一封信准确地分发到张三的办公桌或李四的信箱里。

**总结**: 运输层协议的报文被封装在网络层协议的数据报中。网络层负责在主机间“搬运”这些数据报，而运输层则负责解析这些报文，并将它们交付给正确的应用程序。因此，运输层协议也被称为**端到端协议 (end-to-end protocol)**。

---

### 2. 因特网运输层概述

因特网为应用程序提供了两种主要的、功能迥异的运输层协议：TCP和UDP。

*   **UDP (User Datagram Protocol) - 用户数据报协议**
    *   **服务特性**:
        *   **无连接 (Connectionless)**: 发送数据前不需要建立连接。
        *   **不可靠 (Unreliable)**: 不保证数据一定能送达，不保证数据按序到达，也不保证数据的完整性。
        *   **“尽力而为” (Best-effort)**: UDP尽其所能地交付数据，但对成功与否不做任何承诺。
    *   **提供的功能**: 基本上只在IP协议的基础上增加了**多路复用/分解**（通过端口号）和**差错检测**（通过校验和）的功能。
    *   **类比**: **普通平信**。你把信扔进邮筒就走了，它可能会寄到，也可能会寄丢，或者比后寄的信晚到，邮局对此不负任何责任。
    *   **适用应用**: 对实时性要求高、能容忍少量数据丢失的应用，如DNS查询、在线游戏、视频直播。

*   **TCP (Transmission Control Protocol) - 传输控制协议**
    *   **服务特性**:
        *   **面向连接 (Connection-oriented)**: 在数据传输前，必须通过“三次握手”建立连接。
        *   **可靠的数据传输 (Reliable Data Transfer)**: 通过序列号、确认和重传机制，确保所有数据都能按序、无差错、不重复地送达。
        *   **拥塞控制 (Congestion Control)**: 当网络发生拥塞时，TCP会主动降低发送速率，以维护网络稳定。
        *   **流量控制 (Flow Control)**: 防止发送方压垮接收方。
    *   **类比**: **挂号信或电话通话**。你必须先确认对方已经准备好接收（建立连接），通话过程中你说的话对方都能听到并确认，如果对方没听清（丢包），你会重复一遍（重传）。
    *   **适用应用**: 对数据可靠性要求极高的应用，如网页浏览 (HTTP)、文件传输 (FTP)、电子邮件 (SMTP)。

**安全服务**: 值得注意的是，无论是TCP还是UDP，它们自身都不提供加密等安全服务。为了实现安全通信，我们需要在它们之上运行一个安全协议，即**TLS (Transport Layer Security)**，这将在后续章节中介绍。
