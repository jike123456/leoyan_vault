# 2.1 网络应用程序原理

在深入研究具体的网络协议之前，我们首先需要理解构建一个网络应用程序时所遵循的基本原理。这些原理是独立于任何特定应用的通用设计准则。

---

### 1. 网络应用体系结构 (Application Architecture)

应用程序体系结构由应用程序在各个端系统上的组织方式决定。

*   **客户机-服务器 (Client-Server, C/S) 结构**
    *   **特点**:
        *   **服务器 (Server)**: 一个“始终在线”的主机，拥有固定的IP地址，等待并响应来自客户机的请求。通常位于数据中心。
        *   **客户机 (Client)**: 主动向服务器发起请求，并与服务器通信。可以间歇性地连接到网络，IP地址可能是动态变化的。
    *   **数据流**: 数据主要从服务器流向客户机。
    *   **例子**: Web浏览（浏览器是客户机，Web服务器是服务器）、电子邮件、在线购物。
    *   **缺点**: 服务器容易成为性能瓶颈和单点故障，扩展成本高。

*   **对等 (Peer-to-Peer, P2P) 结构**
    *   **特点**:
        *   对应用程序中的主机（称为**对等方，Peer**）之间的通信利用最小（或不利用）专用服务器。
        *   每个对等方既是客户机（请求服务）也是服务器（提供服务）。
    *   **优点**:
        *   **自扩展性 (Self-scalability)**: 参与的对等方越多，系统的总服务能力也越强。
        *   成本效益高，无需大规模的服务器基础设施。
    *   **例子**: BitTorrent（文件共享）、Skype（早期版本）、比特币。

*   **混合结构 (Hybrid)**
    *   **特点**: 结合了C/S和P2P两种结构的特点。
    *   **例子**: 许多即时通讯应用，登录和好友列表管理可能依赖于中心服务器（C/S部分），而一旦好友建立连接，语音或文件传输可以直接在两个用户之间进行（P2P部分）。

---

### 2. 进程通信 (Process Communication)

*   **进程**: 在端系统上运行的程序。
*   **通信方式**: 不同主机上的进程通过网络交换**报文（Message）**来进行通信。
    *   **客户端进程**: 发起通信的进程。
    *   **服务器进程**: 等待被联系的进程。
*   **套接字 (Socket)**: 进程通过一个称为**套接字**的软件接口向网络发送和接收报文。
    *   **类比**: 套接字就像是应用程序的“门”。进程将报文“推出门外”，由操作系统负责通过网络将报文传送到另一个进程的“门”（套接字）。
    *   为了向一个特定的远程进程发送报文，发送方进程需要指定两项信息：
        1.  **主机的IP地址**：标识目标主机。
        2.  **端口号 (Port Number)**：标识目标主机上的接收进程。

---

### 3. 运输服务 (Transport Services)

应用层协议需要下层的运输层提供什么样的服务？这取决于应用程序的需求。主要有四个维度的服务需求：

*   **可靠数据传输 (Reliable Data Transfer)**
    *   **需求**: 应用程序是否能容忍数据丢失？
    *   **服务**: 如果协议能保证数据100%无差错、完整地交付，就提供了可靠数据传输。
    *   **例子**: 文件传输、电子邮件、Web文档传输必须是可靠的。在线游戏、实时视频可以容忍少量丢包。

*   **吞吐量 (Throughput)**
    *   **需求**: 应用程序是否需要保证最低的数据传输速率才能有效工作？
    *   **服务**: 能够保证最低吞吐量的服务，称为**带宽敏感型应用 (Bandwidth-sensitive applications)**。
    *   **例子**: 多媒体流应用（如视频会议）对吞吐量敏感。而弹性应用（如电子邮件）能根据当前可用的吞吐量灵活调整。

*   **定时 (Timing)**
    *   **需求**: 数据交付是否有严格的时间限制？
    *   **服务**: 运输层协议能否提供延迟保证。
    *   **例子**: IP电话、在线交互式游戏对端到端延迟要求非常高（例如小于100毫秒）。

*   **安全 (Security)**
    *   **需求**: 应用程序是否需要保护通信内容？
    *   **服务**: 运输层协议能否提供加密、数据完整性验证等安全服务。

---

### 4. 因特网提供的运输服务

因特网为应用程序提供了两种主要的运输层协议：

*   **TCP (Transmission Control Protocol)**
    *   **服务**:
        *   **面向连接的服务**: 在数据交换前，客户机和服务器需要先建立连接（三次握手）。
        *   **可靠的数据传输服务**: 保证数据无差错、按序到达。
        *   **拥塞控制**: 当网络拥塞时，会主动抑制发送速率以缓解网络负载。
    *   **不提供的服务**: 不提供吞吐量保证和定时保证。
    *   **应用**: HTTP, FTP, SMTP (电子邮件)。

*   **UDP (User Datagram Protocol)**
    *   **服务**:
        *   **无连接的服务**: 无需建立连接，直接发送数据。
        *   **不可靠的数据传输服务**: 不保证数据能否到达，也不保证顺序。
    *   **优点**: 开销小，速度快，应用层可以更好地控制数据的发送。
    *   **应用**: DNS, 流媒体, 网络电话 (VoIP), 在线游戏。

---

### 5. 应用层协议 (Application-Layer Protocol)

应用层协议定义了运行在不同端系统上的应用程序进程如何相互传递报文。

*   **协议定义的内容**:
    1.  **交换的报文类型**: 例如，请求报文和响应报文。
    2.  **各种报文类型的语法**: 例如，报文中有哪些字段以及如何划分。
    3.  **字段的语义**: 即字段中信息的含义。
    4.  **规则**: 进程何时以及如何发送报文，以及如何响应报文。
*   **开放协议 vs. 私有协议**:
    *   **开放协议**: 由标准组织（如IETF）定义，公开可用。例如HTTP, SMTP。
    *   **私有协议**: 由特定公司或个人开发和控制。例如Skype。
