# 2.7 Socket 编程

网络应用程序通过**套接字（Socket）**来与下层的运输层协议（TCP或UDP）进行交互。套接字是应用程序进程和端到端运输协议之间的接口。

**类比**: 套接字就像是应用程序通向网络世界的“门”。应用程序将要发送的数据“推出门外”，操作系统（运输层）负责将数据打包并送往目的地。同时，从网络到达的数据也会被送到这个“门口”，等待应用程序来领取。

---

### 1. UDP Socket 编程

UDP是一种**无连接**的、**不可靠**的运输服务。使用UDP进行编程相对简单。

*   **工作流程**:
    1.  **服务器端**:
        *   创建一个UDP套接字。
        *   将该套接字绑定到一个熟知的端口号（如 `12000`）。
        *   进入循环，等待接收来自客户端的数据报。
        *   收到数据报后，进行处理，并可能将响应发送回客户端（响应报文中需要包含客户端的IP地址和端口号）。
    2.  **客户端**:
        *   创建一个UDP套接字。
        *   创建一个数据报，其中包含要发送的数据、服务器的IP地址和端口号。
        *   将数据报“推出”套接字。
        *   （可选）等待并接收来自服务器的响应。

*   **特点**:
    *   **没有“连接”**: 客户端在发送数据前，不需要与服务器进行任何的“握手”或预备通信。
    *   **数据报导向**: 每个发送的数据块（数据报）都是独立的，需要明确指定目的地的IP地址和端口号。
    *   **服务器只用一个套接字**: 服务器使用同一个套接字来接收来自所有不同客户端的数据报。

---

### 2. TCP Socket 编程

TCP是一种**面向连接**的、**可靠**的运输服务。其编程模型比UDP稍复杂。

*   **“欢迎套接字”与“连接套接字”**:
    *   **服务器端**有一个特殊的**欢迎套接字（Welcome Socket）**，它像一个公司的“总机”或“前台”。它不负责具体的业务交流，只负责接听新的客户来电。
    *   当一个客户（客户端）“打来电话”（发起连接请求）时，“总机”（欢迎套接字）会接听，然后为这个客户**专门创建一个新的套接字**，并指派一个“专属客服”来通过这个新套接字与客户进行后续的所有交流。这个新的套接字称为**连接套接字（Connection Socket）**。
    *   这样，公司的“总机”就可以继续等待和迎接新的客户，而不会被一个客户占用。

*   **工作流程**:
    1.  **服务器端**:
        *   创建一个TCP**欢迎套接字**。
        *   将该套接字绑定到一个熟知的端口号（如 `12000`），并开始监听连接请求 (`listen`)。
        *   进入循环，当有客户端的连接请求到达时，调用`accept`方法。
        *   `accept`方法会为这个新的客户端连接创建一个**新的连接套接字**。
        *   服务器通过这个**新的连接套接字**与客户端进行数据的发送(`send`)和接收(`recv`)。
        *   通信结束后，关闭**连接套接字**。欢迎套接字保持打开，继续等待其他客户端。
    2.  **客户端**:
        *   创建一个TCP套接字。
        *   调用`connect`方法，向服务器的IP地址和欢迎端口号发起一个TCP连接请求（这会触发三次握手）。
        *   连接建立成功后，客户端就可以通过这个套接字与服务器进行数据的发送(`send`)和接收(`recv`)。
        *   通信结束后，关闭套接字。

*   **特点**:
    *   **面向连接**: 数据交换前必须先建立连接。
    *   **可靠的字节流**: TCP将数据看作是一个连续的、无边界的字节流。它保证所有数据都会按顺序、无差错地到达。开发者无需关心数据的分块、丢失或重传。
    *   **每个客户一个专用套接字**: 服务器为每个连接的客户端创建一个新的套接字，使得服务器能够同时处理多个客户端的并发通信。
