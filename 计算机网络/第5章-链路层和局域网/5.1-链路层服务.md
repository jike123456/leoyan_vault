# 5.1 链路层服务

链路层协议定义了在**同一广播域**的**相邻节点**之间，如何交换数据报。它为上层（网络层）提供了一系列服务，以确保数据能成功地跨越单段物理链路。

---

### 1. 核心服务

*   **成帧 (Framing)**
    *   **功能**: 链路层从网络层接收数据报，并将其封装成一个**帧（Frame）**。一个帧由数据部分（即网络层数据报）和链路层添加的**首部（Header）**及**尾部（Trailer）**组成。
    *   **类比**: 如果网络层数据报是一封信的内容，那么成帧就像是把这封信装进一个标准的信封里。信封上会写上收件人和发件人的**物理地址（MAC地址）**，并可能贴上一些用于差错校验的特殊标记。

*   **链路接入 (Link Access)**
    *   **问题**: 当多个节点共享同一个广播信道时（如WiFi或早期的以太网），必须有一个机制来协调谁可以在何时使用信道。
    *   **功能**: **媒体访问控制（Media Access Control, MAC）协议**负责规定节点在共享介质上发送帧的规则。MAC协议是链路层的一个关键子层。
    *   **类比**: 在一个多人讨论会上，为了避免大家同时说话导致混乱，需要制定发言规则。例如，“先举手，被主持人点到名的人才能发言”，这就是一种MAC协议。

*   **可靠交付 (Reliable Delivery)**
    *   **功能**: 某些链路层协议可以提供可靠的数据交付服务，确保数据帧无差错地从一个节点移动到下一个节点。它通过使用**确认（ACK）**和**重传**机制来实现。
    *   **适用场景**: 这项服务在容易出错的链路上（如高噪声的无线链路）特别有用，因为在链路层解决错误比在运输层（如TCP）解决错误的成本更低、效率更高。
    *   **注意**: 并非所有链路层协议都提供此服务。例如，以太网通常不提供可靠交付，它依赖上层TCP来保证端到端的可靠性。

*   **差错检测和纠正 (Error Detection and Correction)**
    *   **功能**:
        *   **差错检测**: 接收方能够检测出帧在传输过程中是否发生了比特错误。通常通过在帧中加入**差错检测位**（如CRC校验码）来实现。如果检测到错误，接收方通常会丢弃该帧。
        *   **差错纠正**: 接收方不仅能检测到错误，还能确定错误的位置并加以纠正。这需要更多的冗余信息，开销更大。

---

### 2. 链路层在网络中的位置

*   **执行位置**: 与上层协议不同，链路层协议在数据路径上的**每一个节点**（包括主机和路由器）上都会被执行。
*   **工作流程**:
    1.  一台源主机将数据报发送给第一台路由器。这个过程由主机和路由器之间的**链路层协议**控制。
    2.  第一台路由器接收到帧，解封装，将数据报向上传递给自己的网络层。
    3.  路由器的网络层根据转发表，决定将该数据报从哪个输出链路转发出去。
    4.  数据报被传递到该输出链路的链路层，被重新封装成一个新的帧，然后发送给下一台路由器。
    5.  这个过程在路径上的每一个路由器重复进行，直到数据报到达目的主机。

*   **结论**: 一次端到端的通信，实际上是由多段**独立的**、**点到点**的链路层通信接力完成的。每一段“旅程”都可能使用不同的链路层协议（如一段是以太网，下一段是PPP）。
