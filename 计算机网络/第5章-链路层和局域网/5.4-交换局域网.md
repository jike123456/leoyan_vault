# 5.4 交换局域网 (Switched Local Area Networks)

现代的有线局域网（LAN）几乎都是**交换式以太网**。这意味着网络中的核心设备是**链路层交换机**，它取代了早期的集线器（Hub），极大地提高了局域网的性能和效率。

---

### 1. 链路层地址 (MAC 地址)

*   **定义**: 也称为**物理地址**或**硬件地址**。这是一个与网络适配器（网卡）一一对应的、全球唯一的地址。
*   **格式**: 48位（6字节）的地址，通常用十六进制表示，如 `30-5A-3A-44-D2-C0`。
*   **作用**: 在一个局域网内部，链路层使用MAC地址来标识帧的源和目的地。
*   **IP地址 vs. MAC地址**:
    *   **IP地址**: 网络层地址，逻辑地址，可以改变（如你把笔记本从家带到学校）。**类比：你的住址**。
    *   **MAC地址**: 链路层地址，物理地址，固定不变。**类比：你的身份证号**。

---

### 2. 地址解析协议 (Address Resolution Protocol, ARP)

*   **问题**: 在同一个局域网内，当一台主机（如A）想给另一台主机（如B）发送IP数据报时，它知道B的IP地址，但它在构建链路层帧时，需要知道B的MAC地址。如何实现IP地址到MAC地址的“翻译”？
*   **ARP的作用**: ARP就是这个“翻译官”。
*   **工作原理**:
    1.  主机A在自己的**ARP表**（一个存储IP地址到MAC地址映射的缓存）中查找主机B的IP地址。
    2.  如果**找不到**，主机A就在局域网中**广播**一个ARP查询分组。这个分组的大意是：“**谁的IP地址是 `192.168.1.100`？请告诉我你的MAC地址。**”
    3.  局域网中的所有主机都会收到这个广播，但只有IP地址为 `192.168.1.100` 的主机B会做出响应。
    4.  主机B**单播**一个ARP响应分组给主机A，其中包含了它的MAC地址。
    5.  主机A收到响应后，就在自己的ARP表中缓存这个映射关系，然后就可以向主机B发送以太网帧了。

---

### 3. 以太网 (Ethernet)

以太网是当今最主流的有线局域网技术。

*   **帧结构**:
    *   **前同步码**: 用于发送方和接收方时钟同步。
    *   **目的MAC地址** 和 **源MAC地址**: 6字节。
    *   **类型字段**: 指示上层协议是什么（如IP, ARP）。
    *   **数据字段**: 承载网络层数据报。
    *   **CRC校验字段**: 用于差错检测。

---

### 4. 链路层交换机 (Switches)

交换机是现代局域网的核心。它与早期的集线器（Hub）有本质区别。
*   **集线器 (Hub)**: 一个简单的物理层设备，它只是将从一个端口收到的信号放大后，广播给所有其他端口。它是一个“哑设备”，会导致大量的**碰撞**。
*   **交换机 (Switch)**: 一个智能的链路层设备。
    *   **核心功能**: 存储并转发以太网帧。它检查每个到达帧的**目的MAC地址**，并只将该帧从通往该目的地址的**特定端口**转发出去。
    *   **转发与过滤**:
        *   **转发**: 如果目的MAC地址位于交换机表中，并且对应的端口与接收端口不同，则转发。
        *   **过滤**: 如果目的MAC地址对应的端口与接收端口相同，则说明目的主机与发送主机在同一网段，无需转发，直接丢弃该帧。
    *   **自学习 (Self-learning)**: 交换机通过检查每个流入帧的**源MAC地址**来自动构建其转发表。它记录下“在端口X上收到了来自MAC地址Y的帧”，从而学习到主机Y是连接在端口X上的。
    *   **交换机的优越性**:
        1.  **消除碰撞**: 交换机的每个端口都是一个独立的**碰撞域**。不同端口上的主机可以同时通信而不会发生碰撞，极大地提高了LAN的整体吞吐量。
        2.  **异质链路**: 可以连接不同速率（如100Mbps, 1Gbps, 10Gbps）的以太网设备。
        3.  **易于管理**: 即插即用，无需配置。

---

### 5. 虚拟局域网 (VLANs)

*   **动机**: 在一个大型的交换局域网中，有时需要将不同的用户组（如“人力部”和“财务部”）进行隔离，即使他们连接在同一台物理交换机上。
*   **功能**: VLAN允许网络管理员将一台物理交换机配置为多个**虚拟的**、**相互隔离的**局域网。
*   **工作原理**:
    *   交换机端口被分配到不同的VLAN。
    *   属于不同VLAN的端口之间不能直接通信，即使它们在同一台物理交换机上。
    *   如果要跨VLAN通信，流量必须经过一台**路由器**。
*   **优点**:
    *   **提高安全性**: 隔离了不同部门的流量。
    *   **简化管理**: 用户移动位置时，只需重新配置其端口的VLAN归属，而无需改变物理布线。
    *   **限制广播流量**: ARP查询等广播流量只会在其所属的VLAN内部传播，而不会泛滥到整个物理网络。
